<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head></head><body>

















    
    
    
    

  <div class="border-box-sizing">
    <div class="container">

<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1>Module Five Problem Set: Logistic Regression<a rel="noopener" class="anchor-link" href="#Module-Five-Problem-Set:-Logistic-Regression">&#182;</a></h1><p>In this notebook, you have been given a set of steps that will show you how to create a logistic regression model in R. It is very important to run the steps in order. Some steps depend on the outputs of earlier steps. Once you have run all the steps, you will be asked to create your own logistic regression model to help you answer the questions in the Module Five Problem Set. You are expected to write the R script yourself to answer these questions.</p>
<p>Reminder: If you have not already reviewed the Problem Set Report template for your Module Five Problem Set, be sure to do so now. That will give you an idea of the questions you will need to answer with the outputs of this script. You should use the code you are given as reference when writing your own scripts.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Step 1: Loading the Data Set<a rel="noopener" class="anchor-link" href="#Step-1:-Loading-the-Data-Set">&#182;</a></h2><p>You are a risk analyst working for a credit card company. You have access to a set of historical data that can be used to study the relationships between customer characteristics and whether or not they are likely to default on their credit. It is important for the company to calculate the risk that their customers will default on their credit. The table below shows some of the characteristics that will be used in the analysis below.</p>
<p>This block of R code will load the <strong>credit_card_default.csv</strong> data set. Here are the variables that will be retained:</p>
<table>
<thead><tr>
<th><div style="text-align: left;"> Variable </div></th>
<th><div style="text-align: left;"> What does it represent? </div></th>
</tr>
</thead>
<tbody>
<tr>
<td><div style="text-align: left;"> age </div></td>
<td><div style="text-align: left;"> Age of the individual </div></td>
</tr>
<tr>
<td><div style="text-align: left;"> sex </div></td>
<td><div style="text-align: left;"> Sex of the individual (1=male, 2=female) </div></td>
</tr>
<tr>
<td><div style="text-align: left;"> education </div></td>
<td><div style="text-align: left;"> Highest education level attained (1=high school, 2=college, 3=post graduate)</div></td>
</tr>
<tr>
<td><div style="text-align: left;"> marriage </div></td>
<td><div style="text-align: left;"> Is the individual married or unmarried? (1=unmarried, 2=married)</div></td>
</tr>
<tr>
<td><div style="text-align: left;"> assets </div></td>
<td><div style="text-align: left;"> Assets owned by the individual (0=none, 1=car only, 2=house only, 3=car and house) </div></td>
</tr>
<tr>
<td><div style="text-align: left;"> missed_payment </div></td>
<td><div style="text-align: left;"> Did the individual miss payments in the last 3 months? (0=none, 1=missed) </div></td>
</tr>
<tr>
<td><div style="text-align: left;"> credit_utilize </div></td>
<td><div style="text-align: left;"> Credit utilization by the individual, meaning how much of the credit allowed is being used </div></td>
</tr>
<tr>
<td><div style="text-align: left;"> default </div></td>
<td><div style="text-align: left;"> Did the individual default on their credit? (0 = did not default, 1 = default) </div></td>
</tr>
</tbody>
</table>
<p>Note: Credit utilization is expressed as a decimal representing the percentage of your total credit limit you have utilized. For example, if you have used 50% of your credit limit, the value of credit_utilize would be 0.50.
<br/><br/>
Reference: 
Yeh, I. C., &amp; Lien, C. H. (2009). The comparisons of data mining techniques for the predictive accuracy of probability of default of credit card clients. <i>Expert Systems with Applications</i>, 36(2), 2473-2480. Retrieved from <a rel="noopener" href="https://archive.ics.uci.edu/ml/datasets/default+of+credit+card+clients">https://archive.ics.uci.edu/ml/datasets/default+of+credit+card+clients</a>.</p>
<p>Click the code section below and hit the <strong>Run</strong> button above.
<br/><br/>
<font color="red">**Note:** The code section below will first install two R packages: &quot;ResourceSelection&quot; and &quot;pROC&quot;. Please do not move to the next step until the packages are fully installed. This will take some time. Once the installation is complete, this step will print first 6 rows of the data set.</font></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="kp">print</span><span class="p">(</span><span class="s">&quot;The code section below will first install two R packages: ResourceSelection and pROC.&quot;</span><span class="p">)</span> 
<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Please do not move to the next step until the packages are fully installed.&quot;</span><span class="p">)</span> 
<span class="kp">print</span><span class="p">(</span><span class="s">&quot;This will take some time.&quot;</span><span class="p">)</span> 
<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Once the installation is complete, this step will print first 6 rows of the data set.&quot;</span><span class="p">)</span>


<span class="c1"># Loading R packages that are needed for some calculations below</span>
install.packages<span class="p">(</span><span class="s">&quot;ResourceSelection&quot;</span><span class="p">)</span>
install.packages<span class="p">(</span><span class="s">&quot;pROC&quot;</span><span class="p">)</span>

<span class="c1"># Loading credit card default data set</span>
credit_default <span class="o">&lt;-</span> read.csv<span class="p">(</span>file<span class="o">=</span><span class="s">&#39;credit_card_default.csv&#39;</span><span class="p">,</span> header<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> sep<span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">)</span>

<span class="c1"># Converting appropriate variables to factors  </span>
credit_default <span class="o">&lt;-</span> <span class="kp">within</span><span class="p">(</span>credit_default<span class="p">,</span> <span class="p">{</span>
   default <span class="o">&lt;-</span> <span class="kp">factor</span><span class="p">(</span>default<span class="p">)</span>
   sex <span class="o">&lt;-</span> <span class="kp">factor</span><span class="p">(</span>sex<span class="p">)</span>
   education <span class="o">&lt;-</span> <span class="kp">factor</span><span class="p">(</span>education<span class="p">)</span>
   marriage <span class="o">&lt;-</span> <span class="kp">factor</span><span class="p">(</span>marriage<span class="p">)</span>
   assets <span class="o">&lt;-</span> <span class="kp">factor</span><span class="p">(</span>assets<span class="p">)</span>
   missed_payment <span class="o">&lt;-</span> <span class="kp">factor</span><span class="p">(</span>missed_payment<span class="p">)</span>
<span class="p">})</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;installation completed!&quot;</span><span class="p">)</span>
<span class="kp">print</span><span class="p">(</span><span class="s">&quot;data set (first 6 observations)&quot;</span><span class="p">)</span>
<span class="kp">head</span><span class="p">(</span>credit_default<span class="p">,</span> <span class="m">6</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;The code section below will first install two R packages: ResourceSelection and pROC.&quot;
[1] &quot;Please do not move to the next step until the packages are fully installed.&quot;
[1] &quot;This will take some time.&quot;
[1] &quot;Once the installation is complete, this step will print first 6 rows of the data set.&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>Installing package into &#39;/home/codio/R/x86_64-pc-linux-gnu-library/3.4&#39;
(as &#39;lib&#39; is unspecified)
Installing package into &#39;/home/codio/R/x86_64-pc-linux-gnu-library/3.4&#39;
(as &#39;lib&#39; is unspecified)
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;installation completed!&quot;
[1] &quot;data set (first 6 observations)&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
<table>
<caption>A data.frame: 6 &#215; 8</caption>
<thead>
	<tr><th scope="col">age</th><th scope="col">sex</th><th scope="col">education</th><th scope="col">marriage</th><th scope="col">assets</th><th scope="col">missed_payment</th><th scope="col">credit_utilize</th><th scope="col">default</th></tr>
	<tr><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;fct&gt;</th></tr>
</thead>
<tbody>
	<tr><td>28</td><td>2</td><td>2</td><td>2</td><td>0</td><td>1</td><td>0.174</td><td>0</td></tr>
	<tr><td>25</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1.000</td><td>1</td></tr>
	<tr><td>49</td><td>2</td><td>1</td><td>1</td><td>0</td><td>1</td><td>0.540</td><td>1</td></tr>
	<tr><td>26</td><td>2</td><td>2</td><td>2</td><td>3</td><td>0</td><td>0.347</td><td>0</td></tr>
	<tr><td>38</td><td>1</td><td>1</td><td>2</td><td>2</td><td>1</td><td>0.312</td><td>0</td></tr>
	<tr><td>33</td><td>2</td><td>1</td><td>1</td><td>0</td><td>1</td><td>1.000</td><td>1</td></tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Step 2: Creating Logistic Regression Model<a rel="noopener" class="anchor-link" href="#Step-2:-Creating-Logistic-Regression-Model">&#182;</a></h2><p>In this step, you will create a logistic regression model for defaulting on credit as the response variable and education and credit utilization as predictor variables. Education is a qualitative variable and credit utilization is a quantitative variable. A higher level of education is expected to be correlated with higher salary and therefore a lower risk of defaulting. A larger credit utilization is a red flag for financial institutions. Therefore, it is expected that the chance of defaulting is higher if credit utilization is higher.</p>
<p>Note that education has three levels in the data set; 1=high school, 2=college, 3=post graduate. This can be represented by two dummy variables.</p>
<p>The general form of this regression model is:
<br/><br/></p>
<p>\begin{equation*}
\Large E(y) = \frac{e^{({\beta}_0\ +\ {\beta}_1 {x}_1\ +\ {\beta}_2 {x}_2\ + \ {\beta}_3 {x}_3)}}{1+e^{({\beta}_0\ +\ {\beta}_1 {x}_1\ + \ {\beta}_2 {x}_2\ + \ {\beta}_3 {x}_3)}}
\end{equation*}
<br/><br/></p>
<p>\begin{equation*}
\text{where y is 1 for defaulting on credit and 0 for not defaulting on credit,}\ {x}_1\ \text{is credit utilization,}
\end{equation*}
<br/></p>
<p>\begin{equation*}
\text{and}\ \ {x}_2\ \text{and}\ {x}_3\ \text{are dummy variables for education}
\end{equation*}
<br/><br/></p>
<p>This can be transformed to form a model that is linear in the beta terms:
<br/><br/></p>
<p>\begin{equation*}
\large ln(\frac{\pi}{1 - \pi }) = {\beta}_0\ +\ {\beta}_1 {x}_1\ + \ {\beta}_2 {x}_2\ + \ {\beta}_3 {x}_3
\end{equation*}
<br/><br/></p>
<p>The left side of the equation above is the natural log of odds, so this can be written as:
<br/><br/></p>
<p>\begin{equation*}
\large ln(\ odds\ ) = {\beta}_0\ +\ {\beta}_1 {x}_1\ + \ {\beta}_2 {x}_2\ + \ {\beta}_3 {x}_3
\end{equation*}
<br/><br/></p>
<p>The prediction regression equation is:
<br/></p>
<p>\begin{equation*}
\large ln(\ odds\ ) = \hat{{\beta}_0}\ +\ \hat{{\beta}_1} {x}_1\ +\ \hat{{\beta}_2} {x}_2\ +\ \hat{{\beta}_3} {x}_3
\end{equation*}
<br/><br/></p>
<p>\begin{equation*}
\text{where odds is the odds of defaulting (default=1)}
\end{equation*}</p>
<p>\begin{equation*}
\hat{{\beta}_0} \text{,} \hspace{0.25cm} \hat{{\beta}_1} \text{, } \hspace{0.25cm} \hat{{\beta}_2} \text{, } \hspace{0.25cm} \hat{{\beta}_3} \text{  } \text{ are estimates of }
\text{  } {\beta}_0\ \text{,} \hspace{0.25cm} {\beta}_1\ \text{,} \hspace{0.25cm} {\beta}_2\ \text{,} \hspace{0.25cm} {\beta}_3\ \text{ respectively  }
\end{equation*}
<br/><br/></p>
<p>The code below will create the logistic regression model and print statistics for the Wald&#39;s test. Recall that the Wald&#39;s test is for the individual slope (beta) parameters. Click the block of code below and hit the <strong>Run</strong> button above.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="c1"># Create the complete model</span>
logit <span class="o">&lt;-</span> glm<span class="p">(</span>default <span class="o">~</span> credit_utilize <span class="o">+</span> education <span class="p">,</span> data <span class="o">=</span> credit_default<span class="p">,</span> family <span class="o">=</span> <span class="s">&quot;binomial&quot;</span><span class="p">)</span>

<span class="kp">summary</span><span class="p">(</span>logit<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>




<div class="output_text output_subarea">
<pre>
Call:
glm(formula = default ~ credit_utilize + education, family = &quot;binomial&quot;, 
    data = credit_default)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-2.48812  -0.12355   0.00000   0.04386   2.24777  

Coefficients:
               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -8.8488     1.1849  -7.468 8.13e-14 ***
credit_utilize  34.3869     4.0326   8.527  &lt; 2e-16 ***
education2      -1.4975     0.4668  -3.208  0.00134 ** 
education3      -4.2540     0.5963  -7.134 9.72e-13 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 827.93  on 599  degrees of freedom
Residual deviance: 179.33  on 596  degrees of freedom
AIC: 187.33

Number of Fisher Scoring iterations: 9
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3>Interpretation of Beta Estimates<a rel="noopener" class="anchor-link" href="#Interpretation-of-Beta-Estimates">&#182;</a></h3><p>Based on the output in previous step, the regression model is:
<br/><br/></p>
<p>\begin{equation*}
\large \hat{y} = \frac{e^{(-8.8488\ +\ 34.3869 {x}_1\ -\ 1.4975 {x}_2\ -\ 4.2540 {x}_3)}}{1+e^{(-8.8488\ +\ 34.3869 {x}_1\ -\ 1.4975 {x}_2\ -\ 4.2540 {x}_3)}}
\end{equation*}
<br/><br/></p>
<p>The linear form of this can be written as:
<br/><br/>
\begin{equation*}
\large ln(\ odds\ ) = -8.8488\ +\ 34.3869 {x}_1\ -\ 1.4975 {x}_2\ -\ 4.2540 {x}_3
\end{equation*}
<br/><br/></p>
<p><strong>Interpret the estimated coefficient of credit utilization. </strong></p>
<ul>
<li><p>The estimated coefficient for variable credit utilization is 34.3869. This means that on average, the change in log odds for defaulting is 0.343869 for each percentage increase in credit utilization, holding all other variables constant. Note that the figure 0.343869 is obtained by dividing 34.3869 by 100 because credit utilization is expressed as a percentage.
<br/><br/></p>
</li>
<li><p>An alternative way to express this is in terms of odds (and not log odds). If we calculate:
<br/><br/></p>
<p>\begin{equation*}
\large e^{(0.343869)}-1 = 0.4104
\end{equation*}
<br/><br/></p>
<p>The odds of defaulting increase by 41.04% for each percentage increase in credit utilization, holding all other variables constant. Again, the figure 0.343869 is obtained by dividing 34.3869 by 100 because credit utilization is expressed as a percentage. The figure 41.04% is obtained by multiplying the decimal value (0.4104) by 100, to turn the decimal into a percentage.
<br/><br/></p>
</li>
<li><p>Note that the sign for 0.4104 is positive. If this were -0.4104, then the odds of defaulting would <em>decrease</em> by 41.04% for each percentage increase in credit utilization, holding all other variables constant.</p>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Step 3: Wald Confidence Intervals for Slope Parameters<a rel="noopener" class="anchor-link" href="#Step-3:-Wald-Confidence-Intervals-for-Slope-Parameters">&#182;</a></h2><p>This step will print the Wald-based 95% confidence intervals for the slope parameters.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span>conf_int <span class="o">&lt;-</span> confint.default<span class="p">(</span>logit<span class="p">,</span> level<span class="o">=</span><span class="m">0.95</span><span class="p">)</span>
<span class="kp">round</span><span class="p">(</span>conf_int<span class="p">,</span><span class="m">4</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
<table>
<caption>A matrix: 4 &#215; 2 of type dbl</caption>
<thead>
	<tr><th></th><th scope="col">2.5 %</th><th scope="col">97.5 %</th></tr>
</thead>
<tbody>
	<tr><th scope="row">(Intercept)</th><td>-11.1711</td><td>-6.5265</td></tr>
	<tr><th scope="row">credit_utilize</th><td> 26.4832</td><td>42.2906</td></tr>
	<tr><th scope="row">education2</th><td> -2.4125</td><td>-0.5826</td></tr>
	<tr><th scope="row">education3</th><td> -5.4227</td><td>-3.0854</td></tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Step 4: Hosmer-Lemeshow Goodness of Fit (GOF) Test<a rel="noopener" class="anchor-link" href="#Step-4:-Hosmer-Lemeshow-Goodness-of-Fit-(GOF)-Test">&#182;</a></h2><p>This block of R code will run the Hosmer-Lemeshow goodness of fit test to assess whether the model is appropriate for the data set. It evaluates if the predictions for credit default are close to the observed values. The output of the test is the chi-square test statistic and the associated P-value. Recall that the null hypothesis is that the model fits the data and the alternative hypothesis is that the model does not fit the data.</p>
<p>Click the code section below and hit the <strong>Run</strong> button above.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="kn">library</span><span class="p">(</span>ResourceSelection<span class="p">)</span>


<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Hosmer-Lemeshow Goodness of Fit Test&quot;</span><span class="p">)</span>
hl <span class="o">=</span> hoslem.test<span class="p">(</span>logit<span class="o">$</span>y<span class="p">,</span> fitted<span class="p">(</span>logit<span class="p">),</span> g<span class="o">=</span><span class="m">50</span><span class="p">)</span>
hl
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>ResourceSelection 0.3-6 	 2023-06-27
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Hosmer-Lemeshow Goodness of Fit Test&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>Warning message in hoslem.test(logit$y, fitted(logit), g = 50):
&quot;The data did not allow for the requested number of bins.&quot;</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>




<div class="output_text output_subarea">
<pre>
	Hosmer and Lemeshow goodness of fit (GOF) test

data:  logit$y, fitted(logit)
X-squared = 31.582, df = 47, p-value = 0.9588
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Step 5: Confusion Matrix<a rel="noopener" class="anchor-link" href="#Step-5:-Confusion-Matrix">&#182;</a></h2><p>This block of R code will obtain the confusion matrix using the model that is created and calculate the accuracy, precision, and recall. The confusion matrix, also known as an error matrix, allows us to evaluate the performance of the logistic regression model. The rows of the table represent the predicted outcomes, while the columns represent the actual outcomes. The table output is of the form:</p>
<table>
<thead><tr>
<th></th>
<th><strong>Prediction = 0</strong></th>
<th><strong>Prediction = 1</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Actual = 0</strong></td>
<td>True Negatives</td>
<td>False Positives</td>
</tr>
<tr>
<td><strong>Actual = 1</strong></td>
<td>False Negatives</td>
<td>True Positives</td>
</tr>
</tbody>
</table>
<ul>
<li>True Positive (TP): The actual value is 1 (default=1) and the predicted value is 1 (default=1), hence a true positive. </li>
<li>True Negative (TN): The actual value is 0 (default=0) and the predicted value is 0 (default=0), hence a true negative. </li>
<li>False Positive (FP): The actual value is 0 (default=0) and the predicted value is 1 (default=1), hence a false positive. This is also the Type 1 Error.</li>
<li>False Negative (FN): The actual value is 1 (default=1) and the predicted value is 0 (default=0), hence a false negative. This is also the Type 2 Error.</li>
</ul>
<p><br/><br/></p>
<p><strong>Accuracy</strong> is the ratio of the number of correct predictions to the total number of observations.
<br/><br/>
\begin{equation*}
Accuracy = \frac{TP\ +\ TN}{TP\ +\ TN\ +\ FP\ + FN} 
\end{equation*}</p>
<p><br/><br/></p>
<p><strong>Precision</strong> is the ratio of correct positive predictions to the total predicted positives.
<br/><br/>
\begin{equation*}
Precision = \frac{TP}{TP\ +\ FP} 
\end{equation*}</p>
<p><br/><br/></p>
<p><strong>Recall</strong> is the ratio of correct positive predictions to the total positives examples.</p>
<p>\begin{equation*}
Recall = \frac{TP}{TP\ +\ FN} 
\end{equation*}</p>
<p><br/><br/></p>
<p>Click the code section below and hit the <strong>Run</strong> button above.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="c1"># Predict default or no_default for the data set using the model</span>
default_model_data <span class="o">&lt;-</span> credit_default<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;education&#39;</span><span class="p">,</span> <span class="s">&#39;credit_utilize&#39;</span><span class="p">)]</span>
pred <span class="o">&lt;-</span> predict<span class="p">(</span>logit<span class="p">,</span> newdata<span class="o">=</span>default_model_data<span class="p">,</span> type<span class="o">=</span><span class="s">&#39;response&#39;</span><span class="p">)</span>

<span class="c1"># If the predicted probability of default is &gt;=0.50 then predict credit default (default=&#39;1&#39;), otherwise predict no credit </span>
<span class="c1"># default (default=&#39;0&#39;) </span>
depvar_pred <span class="o">=</span> <span class="kp">as.factor</span><span class="p">(</span><span class="kp">ifelse</span><span class="p">(</span>pred <span class="o">&gt;=</span> <span class="m">0.5</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">))</span>

<span class="c1"># This creates the confusion matrix</span>
conf.matrix <span class="o">&lt;-</span> <span class="kp">table</span><span class="p">(</span>credit_default<span class="o">$</span>default<span class="p">,</span> depvar_pred<span class="p">)[</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">,</span><span class="s">&#39;1&#39;</span><span class="p">),</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">,</span><span class="s">&#39;1&#39;</span><span class="p">)]</span>
<span class="kp">rownames</span><span class="p">(</span>conf.matrix<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Actual&quot;</span><span class="p">,</span> <span class="kp">rownames</span><span class="p">(</span>conf.matrix<span class="p">),</span> sep <span class="o">=</span> <span class="s">&quot;: default=&quot;</span><span class="p">)</span>
<span class="kp">colnames</span><span class="p">(</span>conf.matrix<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Prediction&quot;</span><span class="p">,</span> <span class="kp">colnames</span><span class="p">(</span>conf.matrix<span class="p">),</span> sep <span class="o">=</span> <span class="s">&quot;: default=&quot;</span><span class="p">)</span>

<span class="c1"># Print nicely formatted confusion matrix</span>
<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Confusion Matrix&quot;</span><span class="p">)</span>
<span class="kp">format</span><span class="p">(</span>conf.matrix<span class="p">,</span>justify<span class="o">=</span><span class="s">&quot;centre&quot;</span><span class="p">,</span>digit<span class="o">=</span><span class="m">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Confusion Matrix&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
<table>
<caption>A matrix: 2 &#215; 2 of type chr</caption>
<thead>
	<tr><th></th><th scope="col">Prediction: default=0</th><th scope="col">Prediction: default=1</th></tr>
</thead>
<tbody>
	<tr><th scope="row">Actual: default=0</th><td>254</td><td> 22</td></tr>
	<tr><th scope="row">Actual: default=1</th><td> 21</td><td>303</td></tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Step 6: Receiver Operating Characteristic (ROC) Curve<a rel="noopener" class="anchor-link" href="#Step-6:-Receiver-Operating-Characteristic-(ROC)-Curve">&#182;</a></h2><p>This code will plot the ROC curve. The ROC curve measures the performance for a classifier (such as a logistic regression model) at various threshold settings. The area under the curve is an indicator of how well the model distinguishes between y=0 (no default on credit) and y=1 (default on credit). In general, a larger area under the curve is desired as it represents a model that is better at predicting the classes (0 or 1). For this data set, this means that a larger area under the curve represents a model that is better at predicting defaulting or not defaulting on credit.</p>
<p>Click the code section below and hit the <strong>Run</strong> button above.</p>
<p>NOTE: If the plot is not created, click the code section and hit the <strong>Run</strong> button again.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="kn">library</span><span class="p">(</span>pROC<span class="p">)</span>

labels <span class="o">&lt;-</span> credit_default<span class="o">$</span>default
predictions <span class="o">&lt;-</span> logit<span class="o">$</span>fitted.values

roc <span class="o">&lt;-</span> roc<span class="p">(</span>labels <span class="o">~</span> predictions<span class="p">)</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Area Under the Curve (AUC)&quot;</span><span class="p">)</span>
<span class="kp">round</span><span class="p">(</span>auc<span class="p">(</span>roc<span class="p">),</span><span class="m">4</span><span class="p">)</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;ROC Curve&quot;</span><span class="p">)</span>
<span class="c1"># True Positive Rate (Sensitivity) and False Positive Rate (1 - Specificity)</span>
plot<span class="p">(</span>roc<span class="p">,</span> legacy.axes <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>Type &#39;citation(&quot;pROC&quot;)&#39; for a citation.

Attaching package: &#39;pROC&#39;

The following objects are masked from &#39;package:stats&#39;:

    cov, smooth, var

Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Area Under the Curve (AUC)&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
0.9859
</div>

</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;ROC Curve&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Step 7: Prediction<a rel="noopener" class="anchor-link" href="#Step-7:-Prediction">&#182;</a></h2><p>Recall that a logistic regression model predicts the probability of y=1. In this example, it predicts the probability of defaulting on credit (default=1). The code section below predicts the probability of defaulting for an individual who is a high school graduate and has 40% credit utilization and another individual who is a postgraduate and has 35% credit utilization.</p>
<p>Click the block of code below and hit the <strong>Run</strong> button above.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="kp">print</span><span class="p">(</span><span class="s">&quot;Prediction: education is high school (education=&#39;1&#39;), credit utilization is 40% (credit_utilize=0.40)&quot;</span><span class="p">)</span>
newdata1 <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>education<span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">,</span> credit_utilize<span class="o">=</span><span class="m">0.40</span><span class="p">)</span>
pred1 <span class="o">&lt;-</span> predict<span class="p">(</span>logit<span class="p">,</span> newdata1<span class="p">,</span> type<span class="o">=</span><span class="s">&#39;response&#39;</span><span class="p">)</span>
<span class="kp">round</span><span class="p">(</span>pred1<span class="p">,</span> <span class="m">4</span><span class="p">)</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Prediction: education is postgraduate (education=&#39;3&#39;), credit utilization is 35% (credit_utilize=0.35)&quot;</span><span class="p">)</span>
newdata2 <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>education<span class="o">=</span><span class="s">&quot;3&quot;</span><span class="p">,</span> credit_utilize<span class="o">=</span><span class="m">0.35</span><span class="p">)</span>
pred2 <span class="o">&lt;-</span> predict<span class="p">(</span>logit<span class="p">,</span> newdata2<span class="p">,</span> type<span class="o">=</span><span class="s">&#39;response&#39;</span><span class="p">)</span>
<span class="kp">round</span><span class="p">(</span>pred2<span class="p">,</span> <span class="m">4</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Prediction: education is high school (education=&#39;1&#39;), credit utilization is 40% (credit_utilize=0.40)&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
<strong>1:</strong> 0.9927
</div>

</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Prediction: education is postgraduate (education=&#39;3&#39;), credit utilization is 35% (credit_utilize=0.35)&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
<strong>1:</strong> 0.2559
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Your Code<a rel="noopener" class="anchor-link" href="#Your-Code">&#182;</a></h2><p>You have been asked to create logistic regression models in the Module Five Problem Set. Review the Problem Set Report template to see the questions you will be answering about your models.</p>
<p>Use the empty blocks below to write the R code for your model and get outputs. Then use the outputs to answer the questions in your problem set report.</p>
<p><strong>Note: Use the + (plus) button to add new code blocks or the scissor icon to remove empty code blocks, if needed.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="c1"># Regression model with defaulting on credit as response and credit utilization and education as predictors</span>
logit1 <span class="o">&lt;-</span> glm<span class="p">(</span>default <span class="o">~</span> credit_utilize <span class="o">+</span> education <span class="p">,</span> data <span class="o">=</span> credit_default<span class="p">,</span> family <span class="o">=</span> <span class="s">&quot;binomial&quot;</span><span class="p">)</span>
<span class="kp">summary</span><span class="p">(</span>logit1<span class="p">)</span>

<span class="c1"># number of columns</span>
<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Number of Columns&quot;</span><span class="p">)</span>
<span class="kp">ncol</span><span class="p">(</span>credit_default<span class="p">)</span>

<span class="c1"># number of rows</span>
<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Number of rows&quot;</span><span class="p">)</span>
<span class="kp">nrow</span><span class="p">(</span>credit_default<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>




<div class="output_text output_subarea">
<pre>
Call:
glm(formula = default ~ credit_utilize + education, family = &quot;binomial&quot;, 
    data = credit_default)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-2.48812  -0.12355   0.00000   0.04386   2.24777  

Coefficients:
               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -8.8488     1.1849  -7.468 8.13e-14 ***
credit_utilize  34.3869     4.0326   8.527  &lt; 2e-16 ***
education2      -1.4975     0.4668  -3.208  0.00134 ** 
education3      -4.2540     0.5963  -7.134 9.72e-13 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 827.93  on 599  degrees of freedom
Residual deviance: 179.33  on 596  degrees of freedom
AIC: 187.33

Number of Fisher Scoring iterations: 9
</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Number of Columns&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
8
</div>

</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Number of rows&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
600
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="c1"># Predict default or no_default for the data set using the model</span>
default_model_data <span class="o">&lt;-</span> credit_default<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;education&#39;</span><span class="p">,</span> <span class="s">&#39;credit_utilize&#39;</span><span class="p">)]</span>
pred <span class="o">&lt;-</span> predict<span class="p">(</span>logit<span class="p">,</span> newdata<span class="o">=</span>default_model_data<span class="p">,</span> type<span class="o">=</span><span class="s">&#39;response&#39;</span><span class="p">)</span>

<span class="c1"># If the predicted probability of default is &gt;=0.50 then predict credit default (default=&#39;1&#39;), otherwise predict no credit </span>
<span class="c1"># default (default=&#39;0&#39;) </span>
depvar_pred <span class="o">=</span> <span class="kp">as.factor</span><span class="p">(</span><span class="kp">ifelse</span><span class="p">(</span>pred <span class="o">&gt;=</span> <span class="m">0.5</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">))</span>

<span class="c1"># This creates the confusion matrix</span>
conf.matrix <span class="o">&lt;-</span> <span class="kp">table</span><span class="p">(</span>credit_default<span class="o">$</span>default<span class="p">,</span> depvar_pred<span class="p">)[</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">,</span><span class="s">&#39;1&#39;</span><span class="p">),</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">,</span><span class="s">&#39;1&#39;</span><span class="p">)]</span>
<span class="kp">rownames</span><span class="p">(</span>conf.matrix<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Actual&quot;</span><span class="p">,</span> <span class="kp">rownames</span><span class="p">(</span>conf.matrix<span class="p">),</span> sep <span class="o">=</span> <span class="s">&quot;: default=&quot;</span><span class="p">)</span>
<span class="kp">colnames</span><span class="p">(</span>conf.matrix<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Prediction&quot;</span><span class="p">,</span> <span class="kp">colnames</span><span class="p">(</span>conf.matrix<span class="p">),</span> sep <span class="o">=</span> <span class="s">&quot;: default=&quot;</span><span class="p">)</span>

<span class="c1"># Print nicely formatted confusion matrix</span>
<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Confusion Matrix&quot;</span><span class="p">)</span>
<span class="kp">format</span><span class="p">(</span>conf.matrix<span class="p">,</span>justify<span class="o">=</span><span class="s">&quot;centre&quot;</span><span class="p">,</span>digit<span class="o">=</span><span class="m">2</span><span class="p">)</span>

TP <span class="o">=</span> <span class="m">303</span>
FP <span class="o">=</span> <span class="m">22</span>
TN <span class="o">=</span> <span class="m">254</span>
FN <span class="o">=</span> <span class="m">21</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Accuracy&quot;</span><span class="p">)</span>
<span class="kp">print</span><span class="p">((</span>TP <span class="o">+</span> TN<span class="p">)</span><span class="o">/</span><span class="p">(</span>TP <span class="o">+</span> TN <span class="o">+</span> FP <span class="o">+</span> FN<span class="p">))</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Precision&quot;</span><span class="p">)</span>
<span class="kp">print</span><span class="p">((</span>TP<span class="p">)</span><span class="o">/</span><span class="p">(</span>TP<span class="o">+</span>FP<span class="p">))</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Recall&quot;</span><span class="p">)</span>
<span class="kp">print</span><span class="p">((</span>TP<span class="p">)</span><span class="o">/</span><span class="p">(</span>TP<span class="o">+</span>FN<span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Confusion Matrix&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
<table>
<caption>A matrix: 2 &#215; 2 of type chr</caption>
<thead>
	<tr><th></th><th scope="col">Prediction: default=0</th><th scope="col">Prediction: default=1</th></tr>
</thead>
<tbody>
	<tr><th scope="row">Actual: default=0</th><td>254</td><td> 22</td></tr>
	<tr><th scope="row">Actual: default=1</th><td> 21</td><td>303</td></tr>
</tbody>
</table>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Accuracy&quot;
[1] 0.9283333
[1] &quot;Precision&quot;
[1] 0.9323077
[1] &quot;Recall&quot;
[1] 0.9351852
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="c1"># Hosmer-Lemeshow goodness of fit test</span>
<span class="kn">library</span><span class="p">(</span>ResourceSelection<span class="p">)</span>


<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Hosmer-Lemeshow Goodness of Fit Test&quot;</span><span class="p">)</span>
hl <span class="o">=</span> hoslem.test<span class="p">(</span>logit<span class="o">$</span>y<span class="p">,</span> fitted<span class="p">(</span>logit<span class="p">),</span> g<span class="o">=</span><span class="m">50</span><span class="p">)</span>
hl
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Hosmer-Lemeshow Goodness of Fit Test&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>Warning message in hoslem.test(logit$y, fitted(logit), g = 50):
&quot;The data did not allow for the requested number of bins.&quot;</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>




<div class="output_text output_subarea">
<pre>
	Hosmer and Lemeshow goodness of fit (GOF) test

data:  logit$y, fitted(logit)
X-squared = 31.582, df = 47, p-value = 0.9588
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="c1"># Wald&#39;s test</span>
conf_int <span class="o">&lt;-</span> confint.default<span class="p">(</span>logit<span class="p">,</span> level<span class="o">=</span><span class="m">0.95</span><span class="p">)</span>
<span class="kp">round</span><span class="p">(</span>conf_int<span class="p">,</span><span class="m">4</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
<table>
<caption>A matrix: 4 &#215; 2 of type dbl</caption>
<thead>
	<tr><th></th><th scope="col">2.5 %</th><th scope="col">97.5 %</th></tr>
</thead>
<tbody>
	<tr><th scope="row">(Intercept)</th><td>-11.1711</td><td>-6.5265</td></tr>
	<tr><th scope="row">credit_utilize</th><td> 26.4832</td><td>42.2906</td></tr>
	<tr><th scope="row">education2</th><td> -2.4125</td><td>-0.5826</td></tr>
	<tr><th scope="row">education3</th><td> -5.4227</td><td>-3.0854</td></tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="c1"># ROC curve</span>
<span class="kn">library</span><span class="p">(</span>pROC<span class="p">)</span>

labels <span class="o">&lt;-</span> credit_default<span class="o">$</span>default
predictions <span class="o">&lt;-</span> logit<span class="o">$</span>fitted.values

roc <span class="o">&lt;-</span> roc<span class="p">(</span>labels <span class="o">~</span> predictions<span class="p">)</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Area Under the Curve (AUC)&quot;</span><span class="p">)</span>
<span class="kp">round</span><span class="p">(</span>auc<span class="p">(</span>roc<span class="p">),</span><span class="m">4</span><span class="p">)</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;ROC Curve&quot;</span><span class="p">)</span>
<span class="c1"># True Positive Rate (Sensitivity) and False Positive Rate (1 - Specificity)</span>
plot<span class="p">(</span>roc<span class="p">,</span> legacy.axes <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Area Under the Curve (AUC)&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
0.9859
</div>

</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;ROC Curve&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="c1"># Predictions</span>
<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Prediction: education is high school (education=&#39;1&#39;), credit utilization is 35% (credit_utilize=0.35)&quot;</span><span class="p">)</span>
newdata1 <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>education<span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">,</span> credit_utilize<span class="o">=</span><span class="m">0.35</span><span class="p">)</span>
pred1 <span class="o">&lt;-</span> predict<span class="p">(</span>logit<span class="p">,</span> newdata1<span class="p">,</span> type<span class="o">=</span><span class="s">&#39;response&#39;</span><span class="p">)</span>
<span class="kp">round</span><span class="p">(</span>pred1<span class="p">,</span> <span class="m">4</span><span class="p">)</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Prediction: education is postgraduate (education=&#39;3&#39;), credit utilization is 35% (credit_utilize=0.35)&quot;</span><span class="p">)</span>
newdata2 <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>education<span class="o">=</span><span class="s">&quot;3&quot;</span><span class="p">,</span> credit_utilize<span class="o">=</span><span class="m">0.35</span><span class="p">)</span>
pred2 <span class="o">&lt;-</span> predict<span class="p">(</span>logit<span class="p">,</span> newdata2<span class="p">,</span> type<span class="o">=</span><span class="s">&#39;response&#39;</span><span class="p">)</span>
<span class="kp">round</span><span class="p">(</span>pred2<span class="p">,</span> <span class="m">4</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Prediction: education is high school (education=&#39;1&#39;), credit utilization is 35% (credit_utilize=0.35)&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
<strong>1:</strong> 0.9603
</div>

</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Prediction: education is postgraduate (education=&#39;3&#39;), credit utilization is 35% (credit_utilize=0.35)&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
<strong>1:</strong> 0.2559
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="c1"># Model 2</span>
<span class="c1"># Regression model with defaulting on credit as response and credit utilization and education as predictors</span>
logit2 <span class="o">&lt;-</span> glm<span class="p">(</span>default <span class="o">~</span> credit_utilize <span class="o">+</span> assets <span class="o">+</span> missed_payment <span class="p">,</span> data <span class="o">=</span> credit_default<span class="p">,</span> family <span class="o">=</span> <span class="s">&quot;binomial&quot;</span><span class="p">)</span>
<span class="kp">summary</span><span class="p">(</span>logit2<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>




<div class="output_text output_subarea">
<pre>
Call:
glm(formula = default ~ credit_utilize + assets + missed_payment, 
    family = &quot;binomial&quot;, data = credit_default)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-2.50838  -0.10623   0.00001   0.05513   2.32888  

Coefficients:
                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)      -9.2371     1.2320  -7.497 6.51e-14 ***
credit_utilize   32.2826     3.9957   8.079 6.51e-16 ***
assets1          -0.4827     0.4999  -0.966 0.334240    
assets2          -3.0334     0.6038  -5.024 5.05e-07 ***
assets3          -3.4568     0.5806  -5.954 2.61e-09 ***
missed_payment1   1.4276     0.4131   3.455 0.000549 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 827.93  on 599  degrees of freedom
Residual deviance: 171.23  on 594  degrees of freedom
AIC: 183.23

Number of Fisher Scoring iterations: 9
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="c1"># Predict default or no_default for the data set using the model</span>
default_model_data <span class="o">&lt;-</span> credit_default<span class="p">[</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;credit_utilize&#39;</span><span class="p">,</span> <span class="s">&#39;assets&#39;</span><span class="p">,</span> <span class="s">&#39;missed_payment&#39;</span><span class="p">)]</span>
pred <span class="o">&lt;-</span> predict<span class="p">(</span>logit2<span class="p">,</span> newdata<span class="o">=</span>default_model_data<span class="p">,</span> type<span class="o">=</span><span class="s">&#39;response&#39;</span><span class="p">)</span>

<span class="c1"># If the predicted probability of default is &gt;=0.50 then predict credit default (default=&#39;1&#39;), otherwise predict no credit </span>
<span class="c1"># default (default=&#39;0&#39;) </span>
depvar_pred <span class="o">=</span> <span class="kp">as.factor</span><span class="p">(</span><span class="kp">ifelse</span><span class="p">(</span>pred <span class="o">&gt;=</span> <span class="m">0.5</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">))</span>

<span class="c1"># This creates the confusion matrix</span>
conf.matrix <span class="o">&lt;-</span> <span class="kp">table</span><span class="p">(</span>credit_default<span class="o">$</span>default<span class="p">,</span> depvar_pred<span class="p">)[</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">,</span><span class="s">&#39;1&#39;</span><span class="p">),</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">,</span><span class="s">&#39;1&#39;</span><span class="p">)]</span>
<span class="kp">rownames</span><span class="p">(</span>conf.matrix<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Actual&quot;</span><span class="p">,</span> <span class="kp">rownames</span><span class="p">(</span>conf.matrix<span class="p">),</span> sep <span class="o">=</span> <span class="s">&quot;: default=&quot;</span><span class="p">)</span>
<span class="kp">colnames</span><span class="p">(</span>conf.matrix<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">paste</span><span class="p">(</span><span class="s">&quot;Prediction&quot;</span><span class="p">,</span> <span class="kp">colnames</span><span class="p">(</span>conf.matrix<span class="p">),</span> sep <span class="o">=</span> <span class="s">&quot;: default=&quot;</span><span class="p">)</span>

<span class="c1"># Print nicely formatted confusion matrix</span>
<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Confusion Matrix&quot;</span><span class="p">)</span>
<span class="kp">format</span><span class="p">(</span>conf.matrix<span class="p">,</span>justify<span class="o">=</span><span class="s">&quot;centre&quot;</span><span class="p">,</span>digit<span class="o">=</span><span class="m">2</span><span class="p">)</span>

TP <span class="o">=</span> <span class="m">303</span>
FP <span class="o">=</span> <span class="m">14</span>
TN <span class="o">=</span> <span class="m">262</span>
FN <span class="o">=</span> <span class="m">21</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Accuracy&quot;</span><span class="p">)</span>
<span class="kp">print</span><span class="p">((</span>TP <span class="o">+</span> TN<span class="p">)</span><span class="o">/</span><span class="p">(</span>TP <span class="o">+</span> TN <span class="o">+</span> FP <span class="o">+</span> FN<span class="p">))</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Precision&quot;</span><span class="p">)</span>
<span class="kp">print</span><span class="p">((</span>TP<span class="p">)</span><span class="o">/</span><span class="p">(</span>TP<span class="o">+</span>FP<span class="p">))</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Recall&quot;</span><span class="p">)</span>
<span class="kp">print</span><span class="p">((</span>TP<span class="p">)</span><span class="o">/</span><span class="p">(</span>TP<span class="o">+</span>FN<span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Confusion Matrix&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
<table>
<caption>A matrix: 2 &#215; 2 of type chr</caption>
<thead>
	<tr><th></th><th scope="col">Prediction: default=0</th><th scope="col">Prediction: default=1</th></tr>
</thead>
<tbody>
	<tr><th scope="row">Actual: default=0</th><td>262</td><td> 14</td></tr>
	<tr><th scope="row">Actual: default=1</th><td> 21</td><td>303</td></tr>
</tbody>
</table>

</div>

</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Accuracy&quot;
[1] 0.9416667
[1] &quot;Precision&quot;
[1] 0.955836
[1] &quot;Recall&quot;
[1] 0.9351852
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="c1"># Hosmer-Lemeshow goodness of fit test</span>
<span class="kn">library</span><span class="p">(</span>ResourceSelection<span class="p">)</span>


<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Hosmer-Lemeshow Goodness of Fit Test&quot;</span><span class="p">)</span>
hl <span class="o">=</span> hoslem.test<span class="p">(</span>logit2<span class="o">$</span>y<span class="p">,</span> fitted<span class="p">(</span>logit2<span class="p">),</span> g<span class="o">=</span><span class="m">50</span><span class="p">)</span>
hl
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Hosmer-Lemeshow Goodness of Fit Test&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>Warning message in hoslem.test(logit2$y, fitted(logit2), g = 50):
&quot;The data did not allow for the requested number of bins.&quot;</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>




<div class="output_text output_subarea">
<pre>
	Hosmer and Lemeshow goodness of fit (GOF) test

data:  logit2$y, fitted(logit2)
X-squared = 26.733, df = 47, p-value = 0.9924
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="c1"># Wald&#39;s test</span>
conf_int <span class="o">&lt;-</span> confint.default<span class="p">(</span>logit2<span class="p">,</span> level<span class="o">=</span><span class="m">0.95</span><span class="p">)</span>
<span class="kp">round</span><span class="p">(</span>conf_int<span class="p">,</span><span class="m">4</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
<table>
<caption>A matrix: 6 &#215; 2 of type dbl</caption>
<thead>
	<tr><th></th><th scope="col">2.5 %</th><th scope="col">97.5 %</th></tr>
</thead>
<tbody>
	<tr><th scope="row">(Intercept)</th><td>-11.6518</td><td>-6.8224</td></tr>
	<tr><th scope="row">credit_utilize</th><td> 24.4513</td><td>40.1140</td></tr>
	<tr><th scope="row">assets1</th><td> -1.4624</td><td> 0.4971</td></tr>
	<tr><th scope="row">assets2</th><td> -4.2167</td><td>-1.8501</td></tr>
	<tr><th scope="row">assets3</th><td> -4.5947</td><td>-2.3189</td></tr>
	<tr><th scope="row">missed_payment1</th><td>  0.6178</td><td> 2.2373</td></tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="c1"># ROC curve</span>
<span class="kn">library</span><span class="p">(</span>pROC<span class="p">)</span>

labels <span class="o">&lt;-</span> credit_default<span class="o">$</span>default
predictions <span class="o">&lt;-</span> logit2<span class="o">$</span>fitted.values

roc <span class="o">&lt;-</span> roc<span class="p">(</span>labels <span class="o">~</span> predictions<span class="p">)</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;Area Under the Curve (AUC)&quot;</span><span class="p">)</span>
<span class="kp">round</span><span class="p">(</span>auc<span class="p">(</span>roc<span class="p">),</span><span class="m">4</span><span class="p">)</span>

<span class="kp">print</span><span class="p">(</span><span class="s">&quot;ROC Curve&quot;</span><span class="p">)</span>
<span class="c1"># True Positive Rate (Sensitivity) and False Positive Rate (1 - Specificity)</span>
plot<span class="p">(</span>roc<span class="p">,</span> legacy.axes <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;Area Under the Curve (AUC)&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
0.9874
</div>

</div>

<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[1] &quot;ROC Curve&quot;
</pre>
</div>
</div>

<div class="output_area">

<div class="prompt"></div>




<div class="output_png output_subarea">
<img src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-r"><pre><span></span><span class="c1"># Predictions</span>
newdata1 <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>credit_utilize<span class="o">=</span><span class="m">0.35</span><span class="p">,</span> assets<span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">,</span> missed_payment<span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">)</span>
pred1 <span class="o">&lt;-</span> predict<span class="p">(</span>logit2<span class="p">,</span> newdata1<span class="p">,</span> type<span class="o">=</span><span class="s">&#39;response&#39;</span><span class="p">)</span>
<span class="kp">round</span><span class="p">(</span>pred1<span class="p">,</span> <span class="m">4</span><span class="p">)</span>

newdata2 <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>credit_utilize<span class="o">=</span><span class="m">0.35</span><span class="p">,</span> assets<span class="o">=</span><span class="s">&#39;2&#39;</span><span class="p">,</span> missed_payment<span class="o">=</span><span class="s">&#39;0&#39;</span><span class="p">)</span>
pred2 <span class="o">&lt;-</span> predict<span class="p">(</span>logit2<span class="p">,</span> newdata2<span class="p">,</span> type<span class="o">=</span><span class="s">&#39;response&#39;</span><span class="p">)</span>
<span class="kp">round</span><span class="p">(</span>pred2<span class="p">,</span> <span class="m">4</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
<strong>1:</strong> 0.9529
</div>

</div>

<div class="output_area">

<div class="prompt"></div>



<div class="output_html rendered_html output_subarea">
<strong>1:</strong> 0.2746
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>End of Module Five Jupyter Notebook<a rel="noopener" class="anchor-link" href="#End-of-Module-Five-Jupyter-Notebook">&#182;</a></h2><p>Attach the HTML output along with your problem set report for the Module Five Problem Set. The HTML output can be downloaded by clicking <strong>File</strong>, then <strong>Download as</strong>, then <strong>HTML</strong>. Be sure to answer all of the questions in your problem set report.</p>

</div>
</div>
</div>
    </div>
  </div>


 



<script type="module" src="https://s.brightspace.com/lib/bsi/2024.12.210/unbundled/mathjax.js"></script><script type="text/javascript">document.addEventListener('DOMContentLoaded', function() {
						if (document.querySelector('math') || /\$\$|\\\(|\\\[|\\begin{|\\ref{|\\eqref{/.test(document.body.innerHTML)) {
							document.querySelectorAll('mspace[linebreak="newline"]').forEach(elm => {
								elm.setAttribute('style', 'display: block; height: 0.5rem;');
							});

							window.D2L.MathJax.loadMathJax({
								outputScale: 1.5,
								renderLatex: false,
								enableMML3Support: false
							});
						}
					});</script><script type="module" src="https://s.brightspace.com/lib/bsi/2024.12.210/unbundled/prism.js"></script><script type="text/javascript">document.addEventListener('DOMContentLoaded', function() {
					document.querySelectorAll('.d2l-code').forEach(code => {
						window.D2L.Prism.formatCodeElement(code);
					});
				});</script><script type="module" src="https://s.brightspace.com/lib/bsi/2024.12.210/unbundled/embeds.js"></script><script type="text/javascript">document.addEventListener('DOMContentLoaded', function() {
					window.D2L.EmbedRenderer.renderEmbeds(document.body);
				});</script></body></html>